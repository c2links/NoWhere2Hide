<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="styles.css">

  <div class="banner">
    <div>
      <h1></h1>
    </div>  
  </div>

  <title>NoWhere2Hide</title>
  
  <style>
    
  </style>
</head>

<div class="topnav" id="myTopnav">
  <a href="/">C2s</a>
  <a href="/runscan.html">Run Scan</a>
  <a href="/banner.html">Banner Database</a>
  <a href="/http.html">HTTP Database</a>
  <a href="/tls.html">TLS Database</a>
  <a href="/jarm.html">JARM Database</a>
  <a href="/new_sig.html">Create New Signature</a>
  <a href="/view_sigs.html" class="active">View / Edit Signatures</a>
  <a href="/clear_db.html">Clear Databases</a>
  <a href="/readme.html">Readme</a>
</div>

<body>
  
    <script>
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);

      fetch("/GetSig",{method: "POST", body: urlParams})
        .then(response => response.json())
          .then(config => {
            var form = document.getElementById("newSig");

              var name = form.elements["Rule_Name"];
              name.value = config.Rule_Name;
              name.readOnly = true;
              
              var name = form.elements["Malware_Family"];
              name.value = config.Family;
              
              var name = form.elements["classification"];
              name.value = config.Classification;
              
              var name = form.elements["Description"];
              name.value = config.Description;
              
              var name = form.elements["References"];
              name.value = config.References;
              
              targets = config.Targets;
              for (var target of targets){
                var source = target.Source;
                for (var query of target.TargetQuery){
                  popTarget(source,query);
                }

              }

              if(config.Scan_Banner.Enabled){
                popBanner(config.Scan_Banner.Probefile);
              }

              if(config.Scan_HTTP.Enabled){

                if (config.Scan_HTTP.HTTPS){
                  var httpsValue = "Yes";

                }else{
                  var httpsValue = "No";
                }

                var headerString = "";
                if (config.Scan_HTTP.Custom_Headers.length > 0){
                  for (var header of config.Scan_HTTP.Custom_Headers){
                    headerString = headerString + header.Field + ":" + header.Value + "\n" 
                  }
                  
                }

                popHTTP(config.Scan_HTTP.Method, config.Scan_HTTP.Endpoint,config.Scan_HTTP.Useragent,config.Scan_HTTP.Body,headerString,httpsValue)
              }

              if(config.Scan_TLS.Enabled){
                addTLS();
              }

              if(config.Scan_JARM.Enabled){
                addJARM();
              }

              if(config.Detection.Simple){
                var form = document.getElementById("newSig");
                var name = form.elements["condition"];
                name.value = config.Detection.Condition;
                for (var query of  config.Detection.Queries){
                  popDetection(query.Table,query.Query);
                }
              }
              
              if(config.Detection.Module){
                popCustom(config.Detection.Module_name);
                
              }


          })

    </script>

    <script>

      function popTarget(source, query) {
        
        // Date/Time object used to tie target source and queries together
        var timeDate = Date.now() 

        // Target container form
        var input_container = document.getElementById("input-container");
      
        
        var minInt = 1;
        var maxInt = 100000000;
        var randomInt = Math.floor(minInt + Math.random() * (maxInt - minInt + 1));

        // Select form element for Target source
        var targetSelect = document.createElement("select");
        targetSelect.name = randomInt + "_query_" + timeDate;
      
        // Shodan option
        var shodan = document.createElement("option");
        shodan.text = "Shodan";
        shodan.value = "shodan";
        targetSelect.add(shodan);      
        
        // Censys Option
        var censys = document.createElement("option");
        censys.text = "Censys";
        censys.value = "censys";
        targetSelect.add(censys);      

        // targed domains
        var tdomain = document.createElement("option");
        tdomain.text = "Targeted Domains";
        tdomain.value = "tdomain" ;
        targetSelect.add(tdomain); 
        
        // NewDomain Option
        var newdomain = document.createElement("option");
        newdomain.text = "New Domain Feed (No Query)";
        newdomain.value = "newdomain";
        targetSelect.add(newdomain);      
        
        // BadASN Option
        var badasn = document.createElement("option");
        badasn.text = "BadASN (No Query)";
        badasn.value = "badasn";
        targetSelect.add(badasn);

        // ipsum
        var ipsum = document.createElement("option");
        ipsum.text = "IPsum (No Query)";
        ipsum.value = "ipsum" ;
        targetSelect.add(ipsum); 

        
        //URLSCAN.IO
        var urlio = document.createElement("option");
        urlio.text = "URLScan (Future)";
        urlio.value = "urlscan" ;
        targetSelect.add(urlio);
        
        //BinaryEdge
        var be = document.createElement("option");
        be.text = "BinaryEdge (Future)";
        be.value = "binaryedge" ;
        targetSelect.add(be); 
      
      
        input_container.appendChild(targetSelect);
        
        // Set source value
        targetSelect.value = source;    
      
        // Input form element for Query
        var queryInput = document.createElement("input");
        queryInput.type = "text";
        queryInput.name = randomInt + "_query_" + timeDate;
        input_container.appendChild(queryInput);

        // Set query value
        if (source != "badasn") {
          if (source != "newdomain") {
              queryInput.value = query;
          }
        }

        // Newline element
        var newLine = document.createElement("br");
        input_container.appendChild(newLine);

  }

      function popBanner(probeValue) {
        
        // Banner form container
        var banner_container = document.getElementById("banner-container");

        //Banner label for user
        var enableLabel = document.createElement("label");
        enableLabel.innerHTML= "Banner Scanning Enabled. If scanning with a probe, enter it below, leave blank if not.";
        banner_container.appendChild(enableLabel);
        
        // Hidden checkbox to show Banner is enabled
        var bannerCheckbox = document.createElement("input");
        bannerCheckbox.setAttribute("type","checkbox");
        bannerCheckbox.setAttribute("name","Banner_Enabled");
        bannerCheckbox.style.display = "none";
        bannerCheckbox.checked = true;
        banner_container.appendChild(bannerCheckbox);

        // Newline element
        var newLine = document.createElement("br");
        banner_container.appendChild(newLine);
        
        // Textarea box to for probe
        var probe = document.createElement("textarea");
        probe.id = "probe";
        probe.name = "banner_probe";
        probe.rows = 10;
        probe.columns = 40;
        probe.placeholder = "Enter the probe to send here, in hex format \\xff\\xff\\xff (leave blank if none)"
        banner_container.appendChild(probe);

        probe.value = probeValue

        // Newline element
        var newLine = document.createElement("br");
        banner_container.appendChild(newLine);

      }

      function popDetection(tableName,queryValue) {
        
        var minInt = 1;
        var maxInt = 100000000;
        var randomInt = Math.floor(minInt + Math.random() * (maxInt - minInt + 1));

        // Datetime obeject used to tie detection table to query
        var timeDate = Date.now()
        var name = randomInt + "_detection_" + timeDate;
        
        // Query form element
        var query_container = document.getElementById("query-container");

        // Label for table
        var table_label = document.createElement("label");
        table_label.textContent = "Enter table for query"
        table_label.setAttribute("for",name)
        query_container.appendChild(table_label);

        // Query table form element
        var table = document.createElement("select");
        table.name = name
        
        var banner = document.createElement("option");
        banner.text = "banner";
        banner.value = "banner";
        table.add(banner);      
        
        var tls = document.createElement("option");
        tls.text = "tls";
        tls.value = "tls";
        table.add(tls);
        
        var http = document.createElement("option");
        http.text = "http";
        http.value = "http";
        table.add(http);
        
        var jarm = document.createElement("option");
        jarm.text = "jarm";
        jarm.value = "jarm";
        table.add(jarm);  
        
        query_container.appendChild(table);

        // Add table name value
        table.value = tableName;

        // Newline element
        var newLine = document.createElement("br");
        query_container.appendChild(newLine);

        // Newline element
        var newLine = document.createElement("br");
        query_container.appendChild(newLine);

        // Label for table query
        var query_label = document.createElement("label");
        query_label.textContent = "Enter query (follows postgres format do not need to provide the 'Select' and 'From' clauses.)"
        query_label.setAttribute("for",name)
        query_container.appendChild(query_label);
        
        // Table query form element
        var query = document.createElement("input");
        query.type = "text";
        query.name = name;
        query.placeholder = 'banner_text ilike "send%"'
        query_container.appendChild(query);

        // Enter Query value
        query.value = queryValue

        // Newline element
        var newLine = document.createElement("br");
        query_container.appendChild(newLine);

  }

  function popCustom(customName) {
    var custom_container = document.getElementById("custom-container");
    // Label for table query
    var custom_label = document.createElement("label");
    custom_label.textContent = "Enter name of c2 plugin (Note it has to match exactly to what is in the plugin)"
    custom_label.setAttribute("for","c2_plugin")
    custom_container.appendChild(custom_label);

    // Table query form element
    var custom = document.createElement("input");
    custom.type = "text";
    custom.name = "c2_plugin";
    custom.value = customName;
    custom_container.appendChild(custom);

    // Newline element
    var newLine = document.createElement("br");
    custom_container.appendChild(newLine);

  }
  
  function popHTTP(methodValue,endpointValue,useragentValue,BodyValue,customHeadersValue,httpsValue) {
        
        // HTTP form container
        var http_container = document.getElementById("http-container");

        // HTTP label for user
        var enableLabel = document.createElement("label");
        enableLabel.innerHTML= "HTTP Scanning Enabled. Please set the below configuration options";
        http_container.appendChild(enableLabel);

        // Hidden checkbox to indicate HTTP is enabled
        var httpCheckbox = document.createElement("input");
        httpCheckbox.setAttribute("type","checkbox");
        httpCheckbox.setAttribute("name","HTTP_Enabled");
        httpCheckbox.style.display = "none";
        httpCheckbox.checked = true;
        http_container.appendChild(httpCheckbox);

        // Newline element
        var newLine = document.createElement("br");
        http_container.appendChild(newLine);

        // Label for method selection
        var method_label = document.createElement("label");
        method_label.textContent = "HTTP Method"
        method_label.setAttribute("for","http_method")
        http_container.appendChild(method_label);
        
        // HTTP method form element
        var method = document.createElement("select");
        method.name = "http_method";
        
        var get = document.createElement("option");
        get.text = "GET";
        get.value = "GET";
        method.add(get);

        var post = document.createElement("option");
        post.text = "POST";
        post.value = "POST";
        method.add(post);        
        
        // Sets method value
        method.value = methodValue;
        http_container.appendChild(method);


        // Newline element
        var newLine = document.createElement("br");
        http_container.appendChild(newLine);

        // Newline element
        var newLine = document.createElement("br");
        http_container.appendChild(newLine);

        // Label for HTTPS scanning
        var https_label = document.createElement("label");
        https_label.textContent = "HTTPs Scanning"
        https_label.setAttribute("for","http_https")
        http_container.appendChild(https_label);

        // HTTPS form element
        var https = document.createElement("select");
        https.name = "http_https";
        
        var yes = document.createElement("option");
        yes.text = "Yes";
        yes.value = "Yes";
        https.add(yes);

        var no = document.createElement("option");
        no.text = "No";
        no.value = "No";
        https.add(no); 
        
        // Sets HTTPS Value
        https.value = httpsValue;

        http_container.appendChild(https);

        // Newline element
        var newLine = document.createElement("br");
        http_container.appendChild(newLine);

        // Newline element
        var newLine = document.createElement("br");
        http_container.appendChild(newLine);

        // Endpoint label
        var endpoint_label = document.createElement("label");
        endpoint_label.textContent = "Enter endpoint / resource (leave blank if none)"
        endpoint_label.setAttribute("for","http_endpoint")
        http_container.appendChild(endpoint_label);

        // Endpoint form element
        var endpoint = document.createElement("input");
        endpoint.type = "text";
        endpoint.name = "http_endpoint";
        endpoint.placeholder = "/this/is/a/test.php"
        http_container.appendChild(endpoint);

        // Sets endpoint value
        endpoint.value = endpointValue;

        // Newline element
        var newLine = document.createElement("br");
        http_container.appendChild(newLine);
        
        // Newline element
        var newLine = document.createElement("br");
        http_container.appendChild(newLine);

        // Useragent label
        var useragent_label = document.createElement("label");
        useragent_label.textContent = "Enter useragent (leave blank if none)"
        useragent_label.setAttribute("for","http_useragent")
        http_container.appendChild(useragent_label);

        // Useragent form element
        var useragent = document.createElement("input");
        useragent.type = "text";
        useragent.name = "http_useragent";
        useragent.placeholder = "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/119.0"
        http_container.appendChild(useragent);

        // Sets useragent value
        useragent.value = useragentValue;

        // Newline element
        var newLine = document.createElement("br");
        http_container.appendChild(newLine);

        // Newline element
        var newLine = document.createElement("br");
        http_container.appendChild(newLine);

        // HTTP Headers label
        var headers_label = document.createElement("label");
        headers_label.textContent = "Enter custom headers, one per line in the format of 'header : value' (leave blank if none)"
        headers_label.setAttribute("for","http_headers")
        http_container.appendChild(headers_label);

        // HTTP headers form element
        var headers = document.createElement("textarea");
        headers.id = "headers";
        headers.name = "http_headers";
        headers.rows = 10;
        headers.columns = 40;
        headers.placeholder = "server: nginx"

        http_container.appendChild(headers);

        // Sets headers value
        headers.value = customHeadersValue;
        
        // Newline element
        var newLine = document.createElement("br");
        http_container.appendChild(newLine);

        // Newline element
        var newLine = document.createElement("br");
        http_container.appendChild(newLine);

        // Label for HTTP Body
        var body_label = document.createElement("label");
        body_label.textContent = "Enter request body (leave blank if none). Can be in ASCII or hex (\\xff\\xff)."
        body_label.setAttribute("for","http_body")
        http_container.appendChild(body_label);

        // HTTP Body form element
        var body = document.createElement("textarea");
        body.id = "body";
        body.name = "http_body";
        body.rows = 10;
        body.columns = 40;
        body.placeholder = "send me or \\x73\\x65\\x6e\\x64\\x20\\x6d\\x65"

        http_container.appendChild(body);

        // Sets body value
        body.value = BodyValue;

        // Newline element
        var newLine = document.createElement("br");
        http_container.appendChild(newLine);

      }
</script>
        

<script>

  // The remove functions iterate through each row of the form elements and remove them

  function addJARM() {

    // JARM Form container
    var jarm_container = document.getElementById("jarm-container");
    
    // JARM label for user
    var enableLabel = document.createElement("label");
    enableLabel.innerHTML= "JARM Scanning Enabled. No additional options to set.";
    jarm_container.appendChild(enableLabel);


    // Hidden checkbox to show JARM is enabled
    var jarmCheckbox = document.createElement("input");
    jarmCheckbox.setAttribute("type","checkbox");
    jarmCheckbox.setAttribute("name","JARM_Enabled");
    jarmCheckbox.style.display = "none";
    jarmCheckbox.checked = true;
    jarm_container.appendChild(jarmCheckbox);

    // New line element
    var newLine = document.createElement("br"); 
    jarm_container.appendChild(newLine);
  
    }
    
  function removeJARM() {

      var jarm_container = document.getElementById("jarm-container");
      var remove = ["label","input","br"];

      for (var i = 0; i < remove.length; i++) {
        var inputs = jarm_container.getElementsByTagName(remove[i]);
        jarm_container.removeChild(inputs[inputs.length - 1]);
        if (inputs.length > 0) {}
        }

  }

  function addTLS() {
    
    // TLS form container
    var tls_container = document.getElementById("tls-container");

    // TLS label for users
    var enableLabel = document.createElement("label");
    enableLabel.innerHTML= "TLS Scanning Enabled. No additional options to set.";
    tls_container.appendChild(enableLabel);

    // Hidden checkbox to show TLS is enabled
    var tlsCheckbox = document.createElement("input");
    tlsCheckbox.setAttribute("type","checkbox");
    tlsCheckbox.setAttribute("name","TLS_Enabled");
    tlsCheckbox.style.display = "none";
    tlsCheckbox.checked = true;
    tls_container.appendChild(tlsCheckbox);

    // Newline element
    var br = document.createElement("br");
    tls_container.appendChild(br);


  }

  function removeTLS() {

    var tls_container = document.getElementById("tls-container");
    var remove = ["label","input","br"];

    for (var i = 0; i < remove.length; i++) {
      var inputs = tls_container.getElementsByTagName(remove[i]);
      tls_container.removeChild(inputs[inputs.length - 1]);
      if (inputs.length > 0) {}
      }
      
  }

  function addTarget() {
    
    // Date/Time object used to tie target source and queries together
    var timeDate = Date.now() 

    // Target container form
    var input_container = document.getElementById("input-container");
    
    // Select form element for Target source
    var targetSelect = document.createElement("select");
    targetSelect.name = "query_" + timeDate;
    
    // Shodan option
    var shodan = document.createElement("option");
    shodan.text = "Shodan";
    shodan.value = "shodan";
    targetSelect.add(shodan);      
    
    // Censys Option
    var censys = document.createElement("option");
    censys.text = "Censys";
    censys.value = "censys";
    targetSelect.add(censys);      

    // targed domains
    var tdomain = document.createElement("option");
    tdomain.text = "Targeted Domains";
    tdomain.value = "tdomain" ;
    targetSelect.add(tdomain); 
    
    // NewDomain Option
    var newdomain = document.createElement("option");
    newdomain.text = "New Domain Feed (No Query)";
    newdomain.value = "newdomain";
    targetSelect.add(newdomain);      
    
    // BadASN Option
    var badasn = document.createElement("option");
    badasn.text = "BadASN (No Query)";
    badasn.value = "badasn";
    targetSelect.add(badasn);

    // ipsum
    var ipsum = document.createElement("option");
    ipsum.text = "IPsum (No Query)";
    ipsum.value = "ipsum" ;
    targetSelect.add(ipsum); 

    
    //URLSCAN.IO
    var urlio = document.createElement("option");
    urlio.text = "URLScan (Future)";
    urlio.value = "urlscan" ;
    targetSelect.add(urlio);
    
    //BinaryEdge
    var be = document.createElement("option");
    be.text = "BinaryEdge (Future)";
    be.value = "binaryedge" ;
    targetSelect.add(be); 
    
    input_container.appendChild(targetSelect);
    
    // Input form element for Query
    var queryInput = document.createElement("input");
    queryInput.type = "text";
    queryInput.name = "query_" + timeDate;
    input_container.appendChild(queryInput);

    // Newline element
    var newLine = document.createElement("br");
    input_container.appendChild(newLine);

  }

  function removeTarget() {
    
    var input_container = document.getElementById("input-container");
    var remove = ["select","input","br"];

    for (var i = 0; i < remove.length; i++) {
      var inputs = input_container.getElementsByTagName(remove[i]);
      input_container.removeChild(inputs[inputs.length - 1]);
      if (inputs.length > 0) {}
      }
  }

  function addBanner() {
    
    // Banner form container
    var banner_container = document.getElementById("banner-container");


    //Banner label for user
    var enableLabel = document.createElement("label");
    enableLabel.innerHTML= "Banner Scanning Enabled. If scanning with a probe, enter it below, leave blank if not.";
    banner_container.appendChild(enableLabel);
    
    // Hidden checkbox to show Banner is enabled
    var bannerCheckbox = document.createElement("input");
    bannerCheckbox.setAttribute("type","checkbox");
    bannerCheckbox.setAttribute("name","Banner_Enabled");
    bannerCheckbox.style.display = "none";
    bannerCheckbox.checked = true;
    banner_container.appendChild(bannerCheckbox);

    // Newline element
    var newLine = document.createElement("br");
    banner_container.appendChild(newLine);
    
    // Textarea box to for probe
    var probe = document.createElement("textarea");
    probe.id = "probe";
    probe.name = "banner_probe";
    probe.rows = 10;
    probe.columns = 40;
    probe.placeholder = "Enter the probe to send here, in hex format \\xff\\xff\\xff (leave blank if none)"

    banner_container.appendChild(probe);

    // Newline element
    var newLine = document.createElement("br");
    banner_container.appendChild(newLine);

  }

  function removeBanner() {

    var input_container = document.getElementById("banner-container");
    var remove = ["label","input","br","textarea","br"];

    for (var i = 0; i < remove.length; i++) {
      var inputs = input_container.getElementsByTagName(remove[i]);
      input_container.removeChild(inputs[inputs.length - 1]);
      if (inputs.length > 0) {}
      }
  }

  function addHTTP() {
    
    // HTTP form container
    var http_container = document.getElementById("http-container");

    // HTTP label for user
    var enableLabel = document.createElement("label");
    enableLabel.innerHTML= "HTTP Scanning Enabled. Please set the below configuration options";
    http_container.appendChild(enableLabel);

    // Hidden checkbox to indicate HTTP is enabled
    var httpCheckbox = document.createElement("input");
    httpCheckbox.setAttribute("type","checkbox");
    httpCheckbox.setAttribute("name","HTTP_Enabled");
    httpCheckbox.style.display = "none";
    httpCheckbox.checked = true;
    http_container.appendChild(httpCheckbox);

    // Newline element
    var newLine = document.createElement("br");
    http_container.appendChild(newLine);

    // Label for method selection
    var method_label = document.createElement("label");
    method_label.textContent = "HTTP Method"
    method_label.setAttribute("for","http_method")
    http_container.appendChild(method_label);
    
    // HTTP method form element
    var method = document.createElement("select");
    method.name = "http_method";
    
    var get = document.createElement("option");
    get.text = "GET";
    get.value = "GET";
    method.add(get);

    var post = document.createElement("option");
    post.text = "POST";
    post.value = "POST";
    method.add(post);        
    
    // Sets default value as "GET"
    method.value = "GET"
    http_container.appendChild(method);


    // Newline element
    var newLine = document.createElement("br");
    http_container.appendChild(newLine);

    // Newline element
    var newLine = document.createElement("br");
    http_container.appendChild(newLine);

    // Label for HTTPS scanning
    var https_label = document.createElement("label");
    https_label.textContent = "HTTPs Scanning"
    https_label.setAttribute("for","http_https")
    http_container.appendChild(https_label);

    // HTTPS form element
    var https = document.createElement("select");
    https.name = "http_https";
    
    var yes = document.createElement("option");
    yes.text = "Yes";
    yes.value = "Yes";
    https.add(yes);

    var no = document.createElement("option");
    no.text = "No";
    no.value = "No";
    https.add(no); 
    
    // Sets default value to "Yes"
    https.value = "Yes"

    http_container.appendChild(https);

    // Newline element
    var newLine = document.createElement("br");
    http_container.appendChild(newLine);

    // Newline element
    var newLine = document.createElement("br");
    http_container.appendChild(newLine);

    // Endpoint label
    var endpoint_label = document.createElement("label");
    endpoint_label.textContent = "Enter endpoint / resource (leave blank if none)"
    endpoint_label.setAttribute("for","http_endpoint")
    http_container.appendChild(endpoint_label);

    // Endpoint form element
    var endpoint = document.createElement("input");
    endpoint.type = "text";
    endpoint.name = "http_endpoint";
    endpoint.placeholder = "/this/is/a/test.php"
    http_container.appendChild(endpoint);

    // Newline element
    var newLine = document.createElement("br");
    http_container.appendChild(newLine);
    
    // Newline element
    var newLine = document.createElement("br");
    http_container.appendChild(newLine);

    // Useragent label
    var useragent_label = document.createElement("label");
    useragent_label.textContent = "Enter useragent (leave blank if none)"
    useragent_label.setAttribute("for","http_useragent")
    http_container.appendChild(useragent_label);

    // Useragent form element
    var useragent = document.createElement("input");
    useragent.type = "text";
    useragent.name = "http_useragent";
    useragent.placeholder = "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/119.0"
    http_container.appendChild(useragent);

    // Newline element
    var newLine = document.createElement("br");
    http_container.appendChild(newLine);

     // Newline element
    var newLine = document.createElement("br");
    http_container.appendChild(newLine);

    // HTTP Headers label
    var headers_label = document.createElement("label");
    headers_label.textContent = "Enter custom headers, one per line in the format of 'header : value' (leave blank if none)"
    headers_label.setAttribute("for","http_headers")
    http_container.appendChild(headers_label);

    // HTTP headers form element
    var headers = document.createElement("textarea");
    headers.id = "headers";
    headers.name = "http_headers";
    headers.rows = 10;
    headers.columns = 40;
    headers.placeholder = "server: nginx"

    http_container.appendChild(headers);
    
    // Newline element
    var newLine = document.createElement("br");
    http_container.appendChild(newLine);

    // Newline element
    var newLine = document.createElement("br");
    http_container.appendChild(newLine);

    // Label for HTTP Body
    var body_label = document.createElement("label");
    body_label.textContent = "Enter request body (leave blank if none). Can be in ASCII or hex (\\xff\\xff)."
    body_label.setAttribute("for","http_body")
    http_container.appendChild(body_label);

    // HTTP Body form element
    var body = document.createElement("textarea");
    body.id = "body";
    body.name = "http_body";
    body.rows = 10;
    body.columns = 40;
    body.placeholder = "send me or \\x73\\x65\\x6e\\x64\\x20\\x6d\\x65"

    http_container.appendChild(body);

    // Newline element
    var newLine = document.createElement("br");
    http_container.appendChild(newLine);

  }

  function removeHTTP() {
    var input_container = document.getElementById("http-container");
    var remove = ["label","label","input","br","label","select","br","br","select","br","br","label","input","br","br","label","input","br","br","label","textarea","br","br","label","textarea","br"];

    for (var i = 0; i < remove.length; i++) {
      var inputs = input_container.getElementsByTagName(remove[i]);
      input_container.removeChild(inputs[inputs.length - 1]);
      if (inputs.length > 0) {}
      }
  }

  function addQuery() {
    
    // Datetime obeject used to tie detection table to query
    var timeDate = Date.now()
    var name = "detection_" + timeDate;
    
    // Query form element
    var query_container = document.getElementById("query-container");

    // Label for table
    var table_label = document.createElement("label");
    table_label.textContent = "Enter table for query"
    table_label.setAttribute("for",name)
    query_container.appendChild(table_label);

    // Query table form element
    var table = document.createElement("select");
    table.name = name
    
    var banner = document.createElement("option");
    banner.text = "banner";
    banner.value = "banner";
    table.add(banner);      
    
    var tls = document.createElement("option");
    tls.text = "tls";
    tls.value = "tls";
    table.add(tls);
    
    var http = document.createElement("option");
    http.text = "http";
    http.value = "http";
    table.add(http);
    
    var jarm = document.createElement("option");
    jarm.text = "jarm";
    jarm.value = "jarm";
    table.add(jarm);  
    
    query_container.appendChild(table);

    // Newline element
    var newLine = document.createElement("br");
    query_container.appendChild(newLine);

    // Newline element
    var newLine = document.createElement("br");
    query_container.appendChild(newLine);

    // Label for table query
    var query_label = document.createElement("label");
    query_label.textContent = "Enter query (follows postgres format do not need to provide the 'Select' and 'From' clauses.)"
    query_label.setAttribute("for",name)
    query_container.appendChild(query_label);
    
    // Table query form element
    var query = document.createElement("input");
    query.type = "text";
    query.name = name;
    query.placeholder = 'banner_text ilike "send%"'
    query_container.appendChild(query);

    // Newline element
    var newLine = document.createElement("br");
    query_container.appendChild(newLine);

  }

  function removeQuery() {

      var query_container = document.getElementById("query-container");
      var remove = ["label","select","br","br","label","input","br"];

      for (var i = 0; i < remove.length; i++) {
        var inputs = query_container.getElementsByTagName(remove[i]);
        query_container.removeChild(inputs[inputs.length - 1]);
        if (inputs.length > 0) {}
        }

  }
  
  function addCustom() {

    var custom_container = document.getElementById("custom-container");

    // Label for table query
    var custom_label = document.createElement("label");
    custom_label.textContent = "Enter name of c2 plugin (Note it has to match exactly to what is in the plugin)"
    custom_label.setAttribute("for","c2_plugin")
    custom_container.appendChild(custom_label);

    // Table query form element
    var custom = document.createElement("input");
    custom.type = "text";
    custom.name = "c2_plugin";
    custom.placeholder = 'trochilus_banner'
    custom_container.appendChild(custom);

    // Newline element
    var newLine = document.createElement("br");
    custom_container.appendChild(newLine);

}

  function removeCustom() {

    var custom_container = document.getElementById("custom-container");
    var remove = ["label","input","br"];

    for (var i = 0; i < remove.length; i++) {
    var inputs = custom_container.getElementsByTagName(remove[i]);
    custom_container.removeChild(inputs[inputs.length - 1]);
    if (inputs.length > 0) {}
    }

  }

</script>

<h1>View / Edit Signature</h1>
<!--<form action="/AddSig" method="post">-->
<form id="newSig">
<div class="form-container">
  <div class="form-column">
    <h2>General Information<h2>
      <label for="Rule_Name">Rule Name</label>
      <input type="text" id="Rule_Name" name="Rule_Name"><br>
      <label for="Malware_Family">Malware Family</label>
      <input type="text" id="Malware_Family" name="Malware_Family"><br>
      <label for="classification">Classification</label>
      <select name="classification" id="classification">
      <option>Select an option</option>
      <option value="RAT">RAT</option>
      <option value="Backdoor">Backdoor</option>
      <option value="OST">OST</option>
      <option value="Infostealer">Infostealer</option>
      <option value="Admin / Panel">Admin / Panel</option>
      <option value="Vulnerability / Exploit">Vulnerability / Exploit</option>
      <option value="Webshell">Webshell</option>
      <option value="Other">Other</option>
      </select><br><br>
      <label for="Description">Description</label>
      <textarea name="Description" id="Description" cols="20" rows="4"></textarea><br><br>
      <label for="References">References (one per line)</label>
      <textarea name="References" id="References" cols="30" rows="4"></textarea><br><br>
  </div>
  <div class="form-column">
    <h2>Targets (Choose Source and Enter Query)<h2></h2>
    <div id="input-container">
      <!-- Initial input field -->

  </div>
    <button type="button" onclick="addTarget()">Add Target Soruce</button>
    <button type="button" onclick="removeTarget()">Remove Target Source</button> 
  </div>
</div>

<h2>Scanning Modules</h2>
<div class="form-container">
<div class="form-column">
  <h3>Add Banner Scan</h3>
      <div id="banner-container">
    </div>
      <button type="button" onclick="addBanner()">Enable Banner</button>
      <button type="button" onclick="removeBanner()">Disable Banner</button> 
    </div>
<div class="form-column">
  <h3>Add HTTP Scan</h3>
      <div id="http-container">
    </div>
      <button type="button" onclick="addHTTP()">Enable HTTP</button>
      <button type="button" onclick="removeHTTP()">Disable HTTP</button> 
    </div>
</div>

<div class="form-container">
  <div class="form-column">
    <h3>Add TLS Scan</h3>
        <div id="tls-container">
      </div>
        <button type="button" onclick="addTLS()">Enable TLS</button>
        <button type="button" onclick="removeTLS()">Disable TLS</button> 
      </div>
  <div class="form-column">
    <h3>Add JARM Scan</h3>
        <div id="jarm-container">
      </div>
        <button type="button" onclick="addJARM()">Enable JARM</button>
        <button type="button" onclick="removeJARM()">Disable JARM</button> 
      </div>
  </div>

</div>

<h2>Detection Logic</h2>
<div class="form-container">
<div class="form-column">
  <h3>Queries</h3>
      <div id="query-container">
      <label for="condition">Select the condition (any or all) </label>
      <select id="condition" name="condition">
        <option value="all">All</option>
        <option value="any">Any</option>
      </select>
      <br><br>
    </div>  
      <button type="button" onclick="addQuery()">Add Query</button>
      <button type="button" onclick="removeQuery()">Remove Query</button> 
    </div>
<div class="form-column">
  <h3>Custom Module</h3>
      <div id="custom-container">
    </div>
      <button type="button" onclick="addCustom()">Add Custom Detection</button>
      <button type="button" onclick="removeCustom()">Remove Custom Detection</button> 
    </div>
</div>

<input type="submit" value="Submit">
</form>


<script>

document.getElementById("newSig").addEventListener("submit", function(event) {
event.preventDefault(); // Prevent the default form submission behavior

const formData = new URLSearchParams(new FormData(this))

fetch('/AddSig', {
  method: 'POST',
  body: formData
})
.then(response => response.text())
.then(data => {
  // Open a popup window and display the response
  const popupWindow = window.open('', 'Response Popup', 'width=400, height=300');
  popupWindow.document.write(data);
  window.location.href = "/view_sigs.html";
})
.catch(error => {
  console.error(error);
});
});

</script>


  
</body>

</html>